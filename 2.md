# 2. ランク・逆行列・一次方程式　結果から原因を求める
## 2.1 問題設定：逆問題
- y=Ax の形で表すことができる問題は多い
- x(原因)が既知で y(結果)を求める問題を順問題、y が既知で x を求める問題を逆問題という

## 2.2 たちがいい場合(正則行列)
- 逆問題を解くには A の逆行列を求めて A^(-1) y を計算すればいいが、面倒
  - 逆行列が存在しない(どこかの次元が潰れる)場合もある(その場合は解が一意に決まらなくなる)
- 逆行列が存在する正方行列のことを正則行列といい、正則でない行列は特異行列という
- 逆問題とは、すなわち連立方程式のこと
  - 普通に変数を削除して解けばいい
  - その手順を行列として見ると、ブロック行列 (A | y) を (I | s) に変換したときの s が解となる
- 連立方程式を解くときにする操作(基本変形: 行の定数倍、行の入れ替え、ある行の定数倍を他の行に足す)は行列の積で表現できる
- n 次正方行列 A の逆行列 X を求めるとは、つまり AX = I となるような X を求めること
  - 列ごとに見ると、 AX_i = I_i となる X_i を各 i (i=0からn-1) について求めればいい
  - ひとつひとつの X_i は、上で見たように基本変形を繰り返して (A | y) を (I | s) にする処理をすれば求まる
  - しかもどの X_i も同じ基本操作で求めることができるので、全部まとめて (A | I) を (I | X) に変形することを考えれば、X のところに A の逆行列が現れる

## 2.3 たちが悪い場合
- 「たちが悪い」 = 「求めたい情報に対して手がかりが足りない」もしくは「手がかりが多すぎて矛盾する」
- Y = AX で Y から X を求める場合、もし Y の列の数が X の列の数よりも少ないと、「手がかりが足りない」ということになる
  - つまり行列 A によって X を写像する際に、ひとつ以上の軸が潰れてしまっていて、情報が削られてしまっている
- 核(kernel): 与えられた A に対し、AX = o になるような X の集合(= Ker A) つまり元の空間の領域
- 像(image): 与えられた A に対し、X をいろいろ変えた場合に Y = AX が取る値の集合(= Im A) つまり行き先の空間の領域
  - もし(実際の計測で得られた) Y が(ノイズの影響で) Im A に含まれていなかった場合は、対応する X が求められず問題となる
- 全射: 写り先の全ての領域 Y に対し、Y=AX となる X が存在するとき、A は全射
  - Im A(行列 A によって写される領域)が、行き先の全領域に一致するとき、全射
- 単射: 写り先の領域の点 Y に対し、Y=AX となる X がただひとつであるとき、A は単射
  - Ker A(行列 A によって原点 O に写る値の集合)が原点 O のみであるとき、単射
- 次元定理: m x n 行列 A について dim Ker A + dim Im A = n
  - dim Ker A は dim (Ker A) なので、行列 A によって原点 O に潰れる値の集まり
    - dim (Ker A) = 2 なら、2次元の領域(面)が原点 O に潰れる
  - dim Im A は dim (Im A) なので、行列 A によって写される値の集まり
    - dim (Im A) = 2 なら、X を色々動かして AX を求めると2次元空間に散らばる
  - つまり次元定理は、n - dim Ker A = dim Im A とすると
    - m x n 行列(n 次元を m 次元に写す行列)は、n 次元の行列が「Ker A 次元分潰れると」残った次元が Im A である(つまり A による行き先の次元(=m)である)
  - m < n のとき、次元が潰れるので、必ずどこかの複数の点が同一の点に潰れる(単射ではない)
  - m > n のとき、次元が増えるので、全領域をカバーすることができない(全射ではない)
- 次元定理の証明
  - m x n 行列 A の dim Ker A = k, dim Im A = r のとき、k + r = n を証明すればいい
  - Ker A や Im A が線形空間であることを利用して証明 p122
- 行列 A の列ベクトル a1, a2 ... が
  - 線形独立: A によって写像した行列がつぶれない
  - 線形従属: A によって写像した行列がつぶれる
    - ある列ベクトルが他の列ベクトルの和で表現できる状態。a1 が a2 と a3 で表すことができるとき、a1 は a2 と a3 で張られる平面に乗っかっている。つまり a1 成分がどれだけ動いてもこの平面から抜け出すことができない(潰れている)
- 基底と線形独立について、あるベクトルの組が線形独立であっても、それがある空間の基底となるかは不明
  - 空間内のすべての点をベクトルの線形和で表せないといけないので、線形独立なベクトルを限界まで集めないといけない
- dim Im A を A のランクといい、rank A と書く
  - Y=AX に対して、X を色々動かしたときに Y が動く空間が Im A
  - 次元定理があるので Ker A と rank A はほぼ等価。つまり rank がわかれば A が正則かどうかわかる。
- m x n 行列 A のランクが r であるとき、 A = BC (C は r x n 行列、 B は m x r 行列)と表すことができる
  - ランクが r であるなら、 m x n 行列(つまり n 次元ベクトルを m 次元ベクトルに射影する行列)の射影は実質 r 次元
  - n 次元のベクトル X を、まず C で r 次元に圧縮、次に B で m 次元に引き伸ばす(m 次元全体をカバーすることはできない)
- ランクは実質的な手がかりの数を表している
  - 手がかりを定数倍したり、その和を取ったりして水増ししても、手がかりは増えない
  - 行列 A のランクは、A を {a1, a2 ...} という列ベクトルで表した場合の、a1, a2, ... の基底の数である
  - an が線形従属であるなら、何か別の列ベクトルの集まり {b1, ...} で表現することができる
  - それをギリギリまで削った場合の列ベクトルの数がランク
- 一般の行列に対するランクの計算方法
  - 簡単な行列であれば、目視で予測できる
  - 難しい場合は、行列 A に対して基本変形を行って、ランクが自明な形に変形すればいい
    - 正則行列をかけてもランクは変化しない(潰さないような写像を行ってもランクは変化しないのは当然)
    - つまり行列基本変形を行ってもランクは変化しない
  - 基本変形の行列を左からかけると行に対する演算、右からかけると列に対する演算になる

## 2.4 たちの良し悪しの判定(逆行列が存在するための条件)
- ここでは正方行列に限定して考える
  - 正方行列でない場合は、解の一意性か存在性が失われる(複数の点が潰れて同じ場所に押し込められるか、大きな空間に引き伸ばされてしまう)
- 正方行列の場合は、潰れなければ逆行列が存在する、と言える
  - 潰れたらもちろん単射ではなくなるし、全射でおｍなくなってしまう(潰れると入力される空間よりも次元が減るが、出力空間は入力空間と同じ次元分用意されるので)
- ある n 次の正方行列 A が正則である、というのはいろいろな方法で表現できる
  - A の写像が潰れない(行き先の空間で体積が 0 にならない)
    - A の写像は単射(複数の点が行き先の空間で同じ位置に潰れない)
    - Ker A が原点 o のみ(複数の点が行き先の空間で同じ点(原点)に潰れない)
    - dim Ker A = 0(行き先の空間で原点に行く点の集合が、ただ1点のみ(潰れない))
  - A の写像は行き先の空間の全体をカバーする
    - A の写像が全射(A による写像で行き先の空間全体をカバー)
    - Im A が n 次元空間全体(同じ)
    - rank A = n (rank A = dim Im A) (同じ)
  - A の列ベクトル a1...an を考えたときに
    - a1...an が線形独立である(行き先空間の次元は n なので、線形独立なベクトルが n 本あれば、それらは基底をなす)
    - Ax = o となるのは x = o だけ(線形独立の言い換え)
  - これらは A の転置行列でも成り立つ

## 2.5 たちが悪い場合の対策
- たちが悪い場合(正則でない場合)、方程式 y = Ax の解 x が存在しないか、あるいはたいくさん存在する
  - 逆行列が存在しない場合でも解が存在することはあるので注意
  - 元の空間が3次元で、行列 A の写像で1次元につぶれて、行き先の空間が2次元であるとき
    - 1次元に潰れた領域(線)は2次元の行き先空間の中の一部分を占める
    - もし y がこの一部分に含まれる場合は y = Ax に解 x がある
    - このように解 x が1つ見つかった場合、Ker A に属するベクトル z を持ってくれば、 x2 = x + z も解となる
      - Az = o, y = Ax を前提にして、A(x + z) = Ax + Az = Ax = y
    - 逆も正しい。つまり解 x に Ker A に含まれる z を足した x + z ですべての解が求まる。
    - 頑張って見つけた1つの解を特解という
    - Az = o を斉次方程式(Ker A を求める方程式)をいい、その解を一般解という
  - 行列の基本変形を行って解を求める
    - 手がかりが多すぎると矛盾して解がないことがある
    - 少ないとたくさんの解を持つ
 - たくさん解を持つ場合でも、解をひとつに決めたいこともある
   - 最小自乗法で解をひとつ選ぶ
     - Ax - y の長さが小さいほど近い
     - x の長さが小さいほど尤もらしい
  
## 2.6 現実にはたちが悪い場合(特異に近い行列)
- 行列 A の行列式が 0 に近いとき、現実的には A は特異行列と思っていい

p162
