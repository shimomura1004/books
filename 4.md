# 4. 固有値・対角化・Jordan 標準形　暴走の危険があるかを判断
## 4.1 問題設定：安定性
- 出力が、入力だけでなく過去の入力にも依存するシステムについて考える
- まず最初に、入力がずっと 0 なときに、変な初期状態で始めると出力が発散するかどうか、を考える
  - 変数が1つだけであれば単純で、係数の絶対値が 1 よりも大きければ発散する
  - 変数が複数で過去の複数ステップに依存する場合には、ブロック行列を使えばいい
- 時刻 t の出力 x(t) が、過去の出力 x(t-1), x(t-2)... に依存する場合、行列で以下のようにかける
  - x(t) = -0.5x(t-1) + 0.34 x(t-2) + 0.08 x(t-3)
  - 1行が、次の時刻への射影を表している
    - x(t) = -0.5 x(t-1) + 0.34 x(t-2) + 0.08 x(t-3)
    - x(t-1) = x(t-2)
    - x(t-2) = x(t-3)
```
x(t) = [[-0.5 0.34 0.08]  * x(t-1)
          1   0    0   ]
          0   1    0   ]]
```
- 「暴走しない」=「安定」
  - 安定とは、基準距離としてどんな値 ε > 0 を指定されても、以下の条件を満たすような定数 δ > 0 を決めることができること
  - c との距離が δ 以下の点を初期値とすれば、c と x(t) の距離がどの時刻 t においても常に ε 以下にとどまる
- 複数の変数が同時に動いていく場合、行列で表現すると楽: X(t) = AX(t-1)
- 係数 A が対角行列の場合は、各変数は独立に変化していくので簡単

## 4.4 対角化できる場合
- A が対角行列でない場合は以下の手順で解く
 - うまく問題を変換して Y(t) = ΛY(t-1) となるような対角行列 Λ を求める
  - この世界で得られた解を元の世界の値に戻す
```
x(t-1) --A--> x(t)
  ↑P           ↑P
y(t-1) --Λ--> y(t)
```
- x(t) = A x(t-1) なら x(t) = A^t x(0) なので、y(t) = Λ y(t-1) なら y(t) = Λ^t y(0) である
- y(t) = P^(-1) x(t) かつ y(0) = P^(-1) x(0) なので x(t) = P y(t) = P Λ^t y(0) = P Λ^t P^(-1) x(0)
  - x(t) = P y(t) なので注意
  - つまり、対角化さえできれば(P と Λ が求まれば) x の世界の解が得られる
- 行列の基本変形とは別に、 Λ = P^(-1) A P という対角行列を考えなくちゃいけないのはなぜ？
  - P による変形は、t の値に関係なく、すべての x(t) を同時に y(t) に写すことができるもの
    - そのため y(t) を y(t-1) で置き換え、y(t-1) を y(t-2) で置き換え…、というように変形を続けることができる
  - 基本変形は特定の t に対して x(t) を y(t) に写すものなので、今回の用途には使えない
- 任意の行列 A に対し、いい感じの P が存在して、P^(-1)AP が対角行列にできる、は成り立つか？
  - こたえ：たいていの正方行列 A なら作れる
  - P を列ベクトル p1, p2, ...pn と表記する
  - Λ = P^(-1)AP = diag(λ1, ... λn) となるような P が見つけたい
  - 上の式の左側から P をかけると、 AP = P diag(λ1, ... λn)
    - つまり A(p1...pn) = (p1...pn)diag(λ1...λn)
    - つまり (Ap1...Apn) = (λ1p1...λnpn)
    - これは固有値と固有ベクトルである
  - 行列 A の固有ベクトル: 行列 A による写像で、変形しない方向を表す
  - 行列 A の固有値: 行列 A による写像で、固有ベクトルの拡大率
- まとめると、Λ = P^(-1)AP が対角行列となるような P が見つかれば、x(t) = A x(t-1) は x(t) = PΛ^tP^(-1)x(0) と表せる
  - 暴走するかどうかで重要なのは t がかかっている Λ の部分だけ
  - Λ = diag(λ1...λn) なので、行列 A の固有値 λ の絶対値が 1 よりも大きければ暴走、そうでなければ安定となる

## 4.5 固有値・固有ベクトル
- 正方行列 A に対して、 Ap = λp となる p を固有ベクトル、λ を固有値という
  - 固有ベクトルと固有値は複数存在する
  - p はベクトルであって行列ではない(複数の固有ベクトルを列ベクトルとして並べて行列として扱うことはよくある)
  - λ はベクトルではなく数値
- A が実数だけで構成されていても、固有値や固有ベクトルは複素数になることもある
  - 固有値 λ が複素数の場合、その複素共役 bar(λ) も固有値である
    - Ap = λp なら bar(Ap) = bar(λp) なので、bar(A) = A である(なぜなら A は実行列だから)ことを使うと A bar(p) = bar(λ)bar(p) である。つまり bar(p) と bar(λ) も A の固有ベクトルと固有値である
- Ap = λp の式だけで、様々な性質が導かれる(p219)
- 対角行列の対角成分は、そのままその行列の固有値となる(固有ベクトルは単位ベクトル)
- 正方行列 A と同じ大きさの正方行列 S に対して、S^(-1)p は S^(-1)AS の固有ベクトルとなり、固有値は変わらず λ である
  - Ap = λp の元で、(S^(-1)AS)(S^(-1)p) を考えると、 (S^(-1)AS)(S^(-1)p) = S^(-1)Ap 。ここで Ap = λp なので、 S^(-1)Ap = S^(-1)λp 。λは数値なので λS^(-1)p である。つまり (S^(-1)AS)(S^(-1)p) = λS^(-1)p。よって S^(-1)p は固有ベクトル。固有値は λ。
  - つまり A を 変換した S^(-1)AS でも固有値が変わらない
  - 相似変換(写像先の空間が元の空間と同じ)では固有値が変わらない、ということを表している

p223